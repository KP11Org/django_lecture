**Лекция: Теги шаблонов Django**

---

**1. Введение в теги шаблонов Django**  
- **Назначение**: Добавление логики, потока управления и динамического содержимого в HTML-шаблоны.  
- **Синтаксис**: заключен в `{% %}` (для логики) вместо `{{ }}` (для переменных) и `|` (для фильтров).  
- **Роль**: Отделяет представление от бизнес-логики, позволяя использовать повторно используемые компоненты.  
- **Типы**:  
  - **Встроенные теги**: Предопределенные теги для общих задач (например, циклы, условные обозначения).  
  - **Пользовательские теги**: определенные пользователем теги для логики конкретного проекта.  

---

**2. Встроенные теги шаблонов**  

**A. Поток управления**  
1. **Циклы**:  
   ```django
   {% for item in items %}
     <p>{{ item.name }}</p>
   {% empty %}
     <p>No items found.</p>
   {% endfor %}
   ```  
2. **Условные обозначения**:  
   ```django
   {% if user.is_authenticated %}
     <p>Welcome, {{ user.username }}!</p>
   {% elif anonymous_user %}
     <p>Login to continue.</p>
   {% else %}
     <p>Access denied.</p>
   {% endif %}
   ```   

**В. Наследование шаблонов**  
1. **Базовый шаблон**:  
   ```django
   <!-- base.html -->
   <html>
   <head>
     <title>{% block title %}My Site{% endblock %}</title>
   </head>
   <body>
     {% block content %}{% endblock %}
   </body>
   </html>
   ```  
2. **Дочерний шаблон**:  
   ```django
   {% extends "base.html" %}
   {% block title %}Home Page{% endblock %}
   {% block content %}
     <h1>Welcome!</h1>
   {% endblock %}
   ```   

**C. Возможность повторного использования**  
1. **Include**: Встроить другой шаблон:  
   ```django
   {% include "navbar.html" %}
   ```   
2. **URL Resolution**: Создание динамических URL-адресов:  
   ```django
   <a href="{% url 'post_detail' post.id %}">Read More</a>
   ```   

**D. Разное**  
- **With**: Присваиваем переменные:  
  ```django
  {% with total=items|length %}
    <p>Total items: {{ total }}</p>
  {% endwith %}
  ```   
- **Токен CSRF**: Защита форм:  
  ```django
  <form>
    {% csrf_token %}
  </form>
  ```  

---

**3. Создание пользовательских тегов шаблона**  

**A. Настройка**  
1. **Структура каталогов**:  
   ```bash
   myapp/
     templatetags/
       __init__.py
       custom_tags.py  # Your custom tags file
   ```   
2. **Зарегистрировать теги**:  
   ```python
   from django import template
   register = template.Library()
   ```  

**B. Простые теги**  
- Возвращает строку, основанную на вводимых данных:  
  ```python
  @register.simple_tag
  def add_numbers(a, b):
      return f"Sum: {a + b}"
  ```  
- Использование в шаблоне:  
  ```django
  {% load custom_tags %}
  {% add_numbers 5 10 %}  <!-- Output: Sum: 15 -->
  ```   

**C. Теги включения**  
- Визуализация фрагмента шаблона:  
  ```python
  @register.inclusion_tag('sidebar.html')
  def show_sidebar(items):
      return {'sidebar_items': items}
  ```    
- Шаблон (`sidebar.html`):  
  ```django
  <div class="sidebar">
    {% for item in sidebar_items %}
      <p>{{ item }}</p>
    {% endfor %}
  </div>
  ```   
- Использование:  
  ```django
  {% show_sidebar popular_posts %}
  ```   

---

**4. Рекомендации**  
- **Логическое разделение**: Избегайте сложных вычислений; сохраняйте логику в представлениях/моделях.  
- **Возможность повторного использования**: Используйте `include` и пользовательские теги для повторяющихся компонентов (например, заголовков, форм).  
- **Безопасность**: Автоматическое экранирование включено по умолчанию; используйте `|safe` с осторожностью.  
- **Производительность**: Кэширование фрагментов шаблона с помощью `{% cache %}` для больших вычислений.  

---

**5. Пример: Приложение для ведения блога**  

**A. Отображение сообщений с пользовательским форматированием**  
```django
{% load custom_tags %}
{% for post in posts %}
  <div class="post">
    <h2>{{ post.title|title }}</h2>
    <p>Published on: {% format_date post.publish_date %}</p>
    {% if post.is_featured %}
      <span class="badge">Featured</span>
    {% endif %}
  </div>
{% endfor %}
```  

**B. Пользовательский фильтр по дате**  
1. Определите в `custom_tags.py`:  
    ```python
   @register.filter
   def format_date(value):
       return value.strftime("%b %d, %Y")
   ```  
2. Использование:  
   ```django
   {{ post.publish_date|format_date }}
   ```   

---

**6. Распространенные подводные камни**  
- **Отсутствует `{% load %}`**: Забыли загрузить пользовательские библиотеки тегов.  
- **Неправильный порядок**: Размещаем `{% extends %}` в любом месте, кроме первой строки.  
- **Чрезмерное использование**: Использование тегов для улучшения работы с логикой в представлениях (например, при запросах к базе данных).  

---

**7. Заключение**  
- **Основные выводы**:  
  - Теги шаблонов обеспечивают динамический, повторно используемый HTML.  
  - Встроенные теги обрабатывают наиболее распространенные варианты использования.  
  - Пользовательские теги расширяют функциональность для нужд конкретного проекта.  
- **Следующие шаги**:  
  - Изучите сторонние библиотеки, такие как `django-crispy-forms`.  
  - Изучите расширенные шаблоны (например, декораторы тегов шаблонов).  

**Дополнительные ресурсы**:  
- [Ссылка на встроенные теги Django](https://docs.djangoproject.com/en/4.0/ref/templates/builtins/)  
- Книга: *Django 4 на примере* Антонио Меле  

---
### Домашнее задание: теги шаблонов Django

#### Цель:
Цель этого задания — помочь вам понять и попрактиковаться в работе с тегами шаблонов Django. Вы узнаете, как использовать встроенные теги шаблонов, создавать собственные теги шаблонов и применять их в шаблонах Django.

---

### Часть 1: Использование встроенных тегов шаблонов 

1. **Перебираем данные** 
   - В поле `views.py` передайте контекстную переменную `fruits`, содержащую список фруктов (например, `["Яблоко", "Банан", "Вишня"]`).
   - В вашем шаблоне используйте тег `{% for %}`, чтобы отобразить список фруктов в неупорядоченном виде (`<ul>`).

2. **Условное отображение**
   - Передайте переменную контекста `is_authenticated` (со значением `True` или `False`) из вашего представления.
   - В вашем шаблоне используйте тег `{% if %}`, чтобы отобразить «Добро пожаловать, пользователь!» если `is_authenticated` имеет значение `True`, и «Пожалуйста, войдите в систему», если оно равно `False`.

3. **Наследование шаблонов**
   - Создайте базовый шаблон (`base.html`) с тегами `{% block title %}` и `{% block content %}`.
   - Создайте дочерний шаблон (`home.html`), который расширяет `base.html` и переопределяет блоки `title` и `content`. 
   - Используйте теги `{% extends %}` и `{% block %}` для реализации этого. 

---

### Часть 2: Создание пользовательских тегов шаблонов

1. **Создайте простой пользовательский тег шаблона**
   - Создайте пользовательский тег шаблона с именем `current_time`, который отображает текущее время в формате `HH:MM`.
   - Зарегистрируйте тег в каталоге `templatetags`.
   - Используйте тег в шаблоне для отображения текущего времени.

2. **Создайте пользовательский фильтр**
   - Создайте пользовательский фильтр шаблонов с именем `truncate`, который обрезает строку до 50 символов и добавляет многоточие (`...`) в конце.
   - Зарегистрируйте фильтр в каталоге `templatetags`.
   - Используйте фильтр в шаблоне для обрезания длинной строки.

3. **Создайте пользовательский тег включения**
   - Создайте пользовательский тег включения с именем "render_navbar", который отображает панель навигации со ссылками на "Главная страница" и "О программе".
   - Используйте тег в своем шаблоне "base.html" для отображения панели навигации.

---

### Часть 3: Бонус

1. **Расширенный пользовательский тег**
   - Создайте пользовательский тег шаблона с именем `highlight`, который заключает заданное слово в тег `<span>` с классом `highlight`.
   - Используйте тег в шаблоне для выделения определённых слов в абзаце.

---

### **Рекомендации по отправке**  
- Отправьте репозиторий на GitHub с:  
  - Проектом на Django, в котором реализованы все части домашней работы.  
  - `README.md`, скриншоты домашнего задания.  

