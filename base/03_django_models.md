**Лекция: Модели Django**  
**Продолжительность**: 60-75 минут  

---

### **1. Введение в модели Django**  
**Что такое модели?**  
- **Определение**: Классы Python, которые определяют структуру таблиц базы данных.  
- **Назначение**:  
  - Абстрактные операции с базой данных (SQL не требуется).  
  - Определение полей, связей и ограничений.  
  - Служит "единственным источником достоверности" данных.  

**Зачем использовать модели?**  
- **Не зависит от базы данных**: Работает с PostgreSQL, MySQL, SQLite и т.д.  
- **Принцип DRY**: Определяется один раз, используется повторно везде (администратор, формы, API).  
- **Встроенный ORM**: объектно-реляционный преобразователь преобразует код Python в SQL.  

---

### **2. Структура модели**  
#### **Пример: Модель записи в блоге**  
```python  
from django.db import models  
from django.contrib.auth.models import User  

class BlogPost(models.Model):  
    title = models.CharField(max_length=200)  
    content = models.TextField()  
    author = models.ForeignKey(User, on_delete=models.CASCADE)  
    published_date = models.DateTimeField(auto_now_add=True)  
    is_published = models.BooleanField(default=False)  

    def __str__(self):  
        return self.title  

    class Meta:  
        ordering = ['-published_date']  
```   

#### **Ключевые компоненты**  
1. **Поля**:  
   - `CharField`, `TextField`, `DateTimeField`, `BooleanField`, `ForeignKey` и т.д.  
   - **Пример**: `title = models.CharField(max_length=200)`.  
2. **Методы**:  
   - Пользовательская логика (например, `def is_recent(self):`).  
3. **Мета-класс**:  
   - Настройка параметров на уровне модели (порядок, разрешения, подробные имена).  

---

### **3. Типы и опции полей**  
#### **Распространенные типы полей**  
| **Поле** | **Описание** |  
|----------------------|------------------------------------------|  
| `CharField`          | Короткий текст (например, заголовки, имена).        |  
| `TextField`          | Длинный текст (например, содержимое блога).          |  
| `DateTimeField`      | Дата и время (используйте `auto_now_add=True`). |  
| `ForeignKey` | Отношение "один ко многим".                |  
| `ManyToManyField`    | Отношения "многие ко многим".               |  
| `ImageField`         | Загружайте изображения (требуется библиотека Pillow). |  

#### **Параметры поля**  
| **Параметр** | **Описание** |  
|-------------------|------------------------------------------|  
| `max_length`      | Максимальная длина для `CharField`.          |  
| `default`         | Значение по умолчанию (например, `default=False`).   |  
| `blank`/`null` | Разрешает пустые значения в формах/базе данных.    |  
| `choices"         | Ограничьте значения списком вариантов.    |  

**Пример с выбором**:  
```python  
STATUS_CHOICES = [
('D', 'Черновик'),
('P', 'Опубликовано'),
]
status = models.CharField(max_length=1, choices=STATUS_CHOICES, default='D')  
```  

---

### **4. Отношения**  
1. **Один ко многим** (`ForeignKey`):  
   - У записи в блоге **один автор**, у автора ** много записей **.  
   ```python  
   author = models.ForeignKey(пользователь, on_delete=models.КАСКАД)  
   ```  
2. **Много-ко-многим** (`ManyToManyField`):  
   - У записи может быть **много тегов**, тег может принадлежать **многим записям**.  
   ```python  
   теги = модели.ManyToManyField("Tag")  
   ```  
3. **Один к одному** (`OneToOneField`):  
   - У пользователя есть **один профиль**, профиль принадлежит **одному пользователю**.  
   ```python  
   profile = models.OneToOneField(User, on_delete=models.CASCADE)  
   ```    

---

### **5. Методы моделирования**  
Добавьте пользовательскую логику в свои модели:  
```python  
class BlogPost(models.Model):  
    # ... fields ...  

    def is_recent(self):  
        return (timezone.now() - self.published_date).days <= 7  

    def publish(self):  
        self.is_published = True  
        self.save()  
```  

---

### **6. Миграции**  
**Что такое миграции?**  
- Файлы, которые отслеживают изменения в моделях и обновляют схему базы данных.  

**Рабочий процесс**:  
1. Создайте файлы миграции:  
   ```bash  
   python manage.py makemigrations  
   ```  
2. Примените миграции к базе данных:  
   ```bash  
   python manage.py migrate  
   ```   

---

### **7. Интерфейс администратора Django**  
1. **Зарегистрировать модели**:  
   ```python  
   from django.contrib import admin  
   from .models import BlogPost  

   @admin.register(BlogPost)  
   class BlogPostAdmin(admin.ModelAdmin):  
       list_display = ('title', 'author', 'published_date', 'is_published')  
       search_fields = ('title', 'content')  
       list_filter = ('is_published', 'author')  
   ```   
2. **Получить доступ к администратору**:  
   - Перейти на страницу "http://127.0.0.1:8000/admin" после создания суперпользователя.  

---

### **8. Лучшие практики**  
1. **Подробные имена**: Используйте `verbose_name` для удобочитаемых меток полей.  
2. **Нормализация**: Избегайте избыточных данных (логически разделяйте модели).  
3. **Индексация**: Используйте `db_index=True` для часто запрашиваемых полей.  
4. **Проверка**: Добавьте ограничения (например, `unique=True`).  

---

### **Домашнее задание**  
**Цель**: Создать **Систему управления библиотекой** с использованием моделей Django.  

#### **Задачи**  
1. **Создать проект Django**:  
   - Назовите его `библиотека`.  
   - Создайте приложение `книги`.  

2. **Определить модели**:  
    - **Book**: `title`, `author`, `isbn`, `published_date`, `genre` (на выбор: художественная литература, Нон-фикшн, научная фантастика).  
   - **Author**: `name`, `bio`, `birth_date`.  
   - **Genre**: `name` (используйте варианты для предопределенных жанров).  

3. **Отношения**:  
   - У книги **один автор** (используйте "ForeignKey").  
   - Книга может принадлежать **одному жанру** (используйте "CharField" для выбора).  

4. **Настройка администратора**:  
   - Регистрация моделей в `admin.py`.  
   - Добавляйте примеры книг и авторов через интерфейс администратора.  

5. **Бонус**:  
   - Добавьте метод `is_available()" в "Book" (предположим, логическое поле `is_checked_out`).  
   - Настройте представление списка администраторов так, чтобы оно отображало "is_available()".  

#### **Отправка**:  
- Поделитесь своим репозиторием на GitHub.  
- Приложите скриншот вашего интерфейса администратора с указанием книг и авторов.  
- Напишите краткое объяснение ваших типовых взаимосвязей.  
